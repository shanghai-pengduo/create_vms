# create_vms


## 功能说明

1. 实现从vCenter中批量克隆指定虚拟机模板来创建虚拟机；
2. 支持自动判断需要创建的虚拟机已在VCenter中存在同名机器，如有则自动停止运行防止对已存在虚拟机造成误操作；
3. 支持在创建虚拟机时自动按预设的CPU、内存、磁盘、vlan信息来创建虚拟机；
4. 支持在创建虚拟机时自动配置虚拟机系统的主机名，IP地址，网关，DNS等信息；
5. 支持新建的虚拟机创建完毕后自动开机；



## 带来的收益

1. 可以省去登录vCneter并手动从vCenter中克隆虚拟机模板创建虚拟机时填写虚拟机名称、磁盘、vlan信息等一系列手动操作，减少了用户在这方面的时间成本；
2. 据之前测试数据显示，在创建虚拟机的过程中，两分钟内即可完成一台虚拟机的创建，极大的加快的交付虚拟机的速度；
3. 可以直接在创建虚拟机的同时自动自动配置虚拟机的主机名、IP地址、网关、DNS等信息，直接省去用户在创建完毕虚拟机后，通过console登录到虚拟机中再去做这些配置的操作，避免了大量重复手动操作，在一定程度上提高了安全性；



## 实现原理

1. 用户填写一份包含将要创建的虚拟机配置信息的excel表格并将内容保存到ansible服务器的指定文件中；
2. 脚本通过对包含虚拟机信息的文件进行处理后存储创建虚拟机所需的变量，用于创建虚拟机；
3. 从vCenter中克隆创建虚拟机是通过Ansible自带的官方模块来进行，安全可靠；
4. 相关的Ansible模块则是基于pyVmomi这个用于调用VMware vSphere API的Python SDK编写，即创建虚拟机是通过调用VMware的相关API完成；



## 其他说明

1. 需要在ansible server中安装Pyvmomi软件包以支持运行ansible playbook；
2. 暂未发现对ESXi的版本有要求；

